<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health AI Platform - India</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .warning-banner {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .symptoms-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .symptoms-input input {
            flex: 1;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .symptoms-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .symptom-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .symptom-tag .remove {
            cursor: pointer;
            font-weight: bold;
            color: #d32f2f;
        }

        .chat-container {
            height: 400px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 15px;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
        }

        .chat-message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
        }

        .chat-message.assistant {
            background: white;
            border: 1px solid #e2e8f0;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .condition-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .condition-name {
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .probability {
            color: #667eea;
            font-weight: 600;
        }

        .severity {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .severity.low {
            background: #d4edda;
            color: #155724;
        }

        .severity.moderate {
            background: #fff3cd;
            color: #856404;
        }

        .severity.high {
            background: #f8d7da;
            color: #721c24;
        }

        .first-aid {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .first-aid h4 {
            color: #2d5a2d;
            margin-bottom: 10px;
        }

        .first-aid ul {
            margin-left: 20px;
        }

        .first-aid li {
            margin-bottom: 5px;
        }

        .emergency {
            background: #ffebee;
            border: 2px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .emergency h4 {
            color: #d32f2f;
            margin-bottom: 10px;
        }

        .suggested-questions {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .suggested-questions h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .question-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .question-btn:hover {
            background: #1565c0;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        /* Authentication Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .auth-content h2 {
            color: #4a5568;
            margin-bottom: 20px;
            text-align: center;
        }

        .consent-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .consent-form h3 {
            color: #2d5a2d;
            margin-bottom: 15px;
        }

        .consent-form ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .consent-form li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checkbox-group label {
            margin: 0;
            font-weight: normal;
        }

        .emergency-contacts {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .emergency-contacts h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #ffeaa7;
        }

        .contact-item:last-child {
            border-bottom: none;
        }

        .contact-name {
            font-weight: 600;
            color: #856404;
        }

        .contact-number {
            font-weight: bold;
            color: #d63031;
            font-size: 1.1rem;
        }

        .firstaid-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .firstaid-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .firstaid-btn {
                top: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 14px;
            }

            .auth-content {
                margin: 20px;
                padding: 20px;
            }
        }
        /* Emergency SOS Button */
    .sos-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: red;
      color: white;
      border: none;
      padding: 12px 18px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .sos-popup {
      display: none;
      position: fixed;
      bottom: 70px;
      right: 20px;
      background: white;
      color: black;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      z-index: 1000;
    }
        .sos-popup h3 {
      margin-top: 0;
      color: red;
    }

        /* Service Selection Styles */
        .service-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .service-btn {
            background: #f8f9fa;
            border: 2px solid #e2e8f0;
            color: #4a5568;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .service-btn:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .service-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        /* Service-specific content */
        .service-content {
            display: none;
        }

        .service-content.active {
            display: block;
        }

        /* Nutrition specific styles */
        .nutrition-form {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Physio specific styles */
        .physio-form {
            background: #f0fdf4;
            border: 2px solid #22c55e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Blood bank specific styles */
        .blood-bank-form {
            background: #fef2f2;
            border: 2px solid #ef4444;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .blood-type-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .blood-type-btn {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .blood-type-btn:hover {
            background: #f8f9fa;
        }

        .blood-type-btn.selected {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .urgency-levels {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .urgency-btn {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .urgency-btn:hover {
            background: #f8f9fa;
        }

        .urgency-btn.selected {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }

        .urgency-btn.critical {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .urgency-btn.critical:hover {
            background: #dc2626;
        }

        /* Results display */
        .service-results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .donor-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .hospital-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .blood-availability {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #e8f5e8;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .blood-units {
            font-weight: bold;
            color: #22c55e;
        }

    </style>
</head>
<body>
    <!-- First Aid Button -->
    <button class="firstaid-btn" onclick="openFirstAid()">üöë First Aid</button>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-content">
            <h2>üè• Health AI </h2>
            <p style="text-align: center; margin-bottom: 20px; color: #666;">Welcome to India's Health AI Platform</p>
            
            <form id="authForm">
                <div class="form-group">
                    <label for="userName">Full Name:</label>
                    <input type="text" id="userName" required placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label for="userAge">Age:</label>
                    <input type="number" id="userAge" required min="1" max="120" placeholder="Your age">
                </div>
                
                <div class="form-group">
                    <label for="userGender">Gender:</label>
                    <select id="userGender" required>
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="userLocation">Location (State):</label>
                    <select id="userLocation" required>
                        <option value="">Select your state</option>
                        <option value="andhra_pradesh">Andhra Pradesh</option>
                        <option value="arunachal_pradesh">Arunachal Pradesh</option>
                        <option value="assam">Assam</option>
                        <option value="bihar">Bihar</option>
                        <option value="chhattisgarh">Chhattisgarh</option>
                        <option value="goa">Goa</option>
                        <option value="gujarat">Gujarat</option>
                        <option value="haryana">Haryana</option>
                        <option value="himachal_pradesh">Himachal Pradesh</option>
                        <option value="jharkhand">Jharkhand</option>
                        <option value="karnataka">Karnataka</option>
                        <option value="kerala">Kerala</option>
                        <option value="madhya_pradesh">Madhya Pradesh</option>
                        <option value="maharashtra">Maharashtra</option>
                        <option value="manipur">Manipur</option>
                        <option value="meghalaya">Meghalaya</option>
                        <option value="mizoram">Mizoram</option>
                        <option value="nagaland">Nagaland</option>
                        <option value="odisha">Odisha</option>
                        <option value="punjab">Punjab</option>
                        <option value="rajasthan">Rajasthan</option>
                        <option value="sikkim">Sikkim</option>
                        <option value="tamil_nadu">Tamil Nadu</option>
                        <option value="telangana">Telangana</option>
                        <option value="tripura">Tripura</option>
                        <option value="uttar_pradesh">Uttar Pradesh</option>
                        <option value="uttarakhand">Uttarakhand</option>
                        <option value="west_bengal">West Bengal</option>
                        <option value="delhi">Delhi</option>
                        <option value="jammu_kashmir">Jammu & Kashmir</option>
                        <option value="ladakh">Ladakh</option>
                    </select>
                </div>

                <div class="emergency-contacts">
                    <h3>üö® Emergency Contacts - India</h3>
                    <div class="contact-item">
                        <span class="contact-name">Emergency Services</span>
                        <span class="contact-number">108</span>
                    </div>
                    <div class="contact-item">
                        <span class="contact-name">Police</span>
                        <span class="contact-number">100</span>
                    </div>
                    <div class="contact-item">
                        <span class="contact-name">Fire Service</span>
                        <span class="contact-number">101</span>
                    </div>
                    <div class="contact-item">
                        <span class="contact-name">Ambulance</span>
                        <span class="contact-number">102</span>
                    </div>
                    <div class="contact-item">
                        <span class="contact-name">Women Helpline</span>
                        <span class="contact-number">1091</span>
                    </div>
                    <div class="contact-item">
                        <span class="contact-name">Child Helpline</span>
                        <span class="contact-number">1098</span>
                    </div>
                    <div class="contact-item">
                        <span class="contact-name">Mental Health</span>
                        <span class="contact-number">1800-599-0019</span>
                    </div>
                </div>

                <div class="consent-form">
                    <h3>üìã Consent & Terms of Use</h3>
                    <p><strong>Please read and agree to the following terms:</strong></p>
                    <ul>
                        <li>This platform is for <strong>educational purposes only</strong> and is not a substitute for professional medical advice, diagnosis, or treatment.</li>
                        <li>I understand that this AI system provides <strong>preliminary health information</strong> and should not be used for emergency situations.</li>
                        <li>I agree to <strong>consult qualified healthcare professionals</strong> for proper medical evaluation and treatment.</li>
                        <li>I understand that in case of <strong>medical emergency</strong>, I should call 108 (Emergency Services) or visit the nearest hospital immediately.</li>
                        <li>I consent to the <strong>collection and storage</strong> of my health information for educational and research purposes.</li>
                        <li>I understand that my data will be <strong>stored securely</strong> and used only for improving the platform's services.</li>
                        <li>I acknowledge that the platform may not be <strong>100% accurate</strong> and should be used as a supplementary tool only.</li>
                        <li>I agree to use this platform <strong>responsibly</strong> and not for self-diagnosis or treatment.</li>
                    </ul>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="consentCheck" required>
                    <label for="consentCheck">I have read and agree to the terms and conditions above</label>
                </div>

                <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Proceed to Health Platform</button>
            </form>
        </div>
    </div>

    <div class="container hidden" id="mainContent">
        <div class="header">
            <h1>üè• Health AI Platform - India</h1>
            <p>Simple Symptom Analysis & Chat Assistant for Indian Healthcare</p>
        </div>

        <div class="warning-banner">
            ‚ö†Ô∏è This platform is for educational purposes only. It is NOT a substitute for professional medical advice, diagnosis, or treatment.
        </div>

        <div class="main-content">
            <!-- Service Selection -->
            <div class="card" style="grid-column: 1 / -1; margin-bottom: 20px;">
                <h2>üè• Choose Your Health Service</h2>
                <div class="service-buttons">
                    <button class="service-btn active" onclick="selectService('general')" id="generalBtn">
                        ü©∫ General Health
                    </button>
                    <button class="service-btn" onclick="selectService('nutrition')" id="nutritionBtn">
                        ü•ó Nutrition
                    </button>
                    <button class="service-btn" onclick="selectService('physio')" id="physioBtn">
                        üèÉ Physiotherapy
                    </button>
                    <button class="service-btn" onclick="selectService('blood_bank')" id="bloodBankBtn">
                        ü©∏ Blood Bank
                    </button>
                    <button class="service-btn" onclick="selectService('hospital')" id="hospitalBtn">
                        üè• Hospital Finder
                    </button>
                </div>
            </div>

            <!-- Symptom Analysis Card -->
            <div class="card" id="symptomCard">
                <h2>üîç Symptom Analysis</h2>
                <form id="symptomForm">
                    <div class="form-group">
                        <label for="symptoms">Symptoms (add one at a time):</label>
                        <div class="symptoms-input">
                            <input type="text" id="symptomInput" placeholder="e.g., headache, fever, cough">
                            <button type="button" class="btn" onclick="addSymptom()">Add</button>
                        </div>
                        <div class="symptoms-list" id="symptomsList"></div>
                    </div>

                    <div class="form-group">
                        <label for="duration">Duration:</label>
                        <select id="duration">
                            <option value="">Select duration</option>
                            <option value="less than 1 hour">Less than 1 hour</option>
                            <option value="1-6 hours">1-6 hours</option>
                            <option value="6-24 hours">6-24 hours</option>
                            <option value="1-3 days">1-3 days</option>
                            <option value="3-7 days">3-7 days</option>
                            <option value="more than 1 week">More than 1 week</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="severity">Severity:</label>
                        <select id="severity">
                            <option value="">Select severity</option>
                            <option value="low">Low (mild discomfort)</option>
                            <option value="moderate">Moderate (noticeable but manageable)</option>
                            <option value="high">High (severe, affecting daily activities)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="age">Age (optional):</label>
                        <input type="number" id="age" min="0" max="120" placeholder="Your age">
                    </div>

                    <div class="form-group">
                        <label for="gender">Gender (optional):</label>
                        <select id="gender">
                            <option value="">Select gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="additionalInfo">Additional Information:</label>
                        <textarea id="additionalInfo" rows="3" placeholder="Any other relevant information..."></textarea>
                    </div>

                    <button type="submit" class="btn" id="analyzeBtn">Analyze Symptoms</button>
                </form>

                <div id="symptomResults" class="results" style="display: none;"></div>
            </div>

            <!-- Chat Assistant Card -->
            <div class="card">
                <h2>üí¨ Chat Assistant</h2>
                <div class="chat-container" id="chatContainer">
                    <div class="chat-message assistant">
                        Hello! I'm here to help with your health concerns. You can ask me questions about your symptoms, and I'll do my best to provide helpful information. Remember, this is for educational purposes only.
                    </div>
                </div>

                <div class="form-group">
                    <div class="symptoms-input">
                        <input type="text" id="chatInput" placeholder="Ask me about your symptoms...">
                        <button type="button" class="btn" onclick="sendChatMessage()">Send</button>
                    </div>
                </div>

                <div id="suggestedQuestions" class="suggested-questions" style="display: none;">
                    <h4>Suggested Questions:</h4>
                    <div id="questionsList"></div>
                </div>
            </div>

            <!-- Nutrition Service Content -->
            <div class="service-content" id="nutritionContent">
                <div class="card">
                    <h2>ü•ó Nutrition Consultation</h2>
                    <div class="nutrition-form">
                        <div class="form-group">
                            <label for="nutritionQuery">What nutrition advice do you need?</label>
                            <textarea id="nutritionQuery" rows="3" placeholder="e.g., I want to lose weight, I have diabetes, I need muscle building diet..."></textarea>
                        </div>
                        <button type="button" class="btn" onclick="getNutritionAdvice()">Get Nutrition Advice</button>
                    </div>
                    <div id="nutritionResults" class="service-results" style="display: none;"></div>
                </div>
            </div>

            <!-- Physiotherapy Service Content -->
            <div class="service-content" id="physioContent">
                <div class="card">
                    <h2>üèÉ Physiotherapy Consultation</h2>
                    <div class="physio-form">
                        <div class="form-group">
                            <label for="physioQuery">What physiotherapy help do you need?</label>
                            <textarea id="physioQuery" rows="3" placeholder="e.g., I have back pain, I need posture correction, I want to strengthen my muscles..."></textarea>
                        </div>
                        <button type="button" class="btn" onclick="getPhysioAdvice()">Get Physiotherapy Advice</button>
                    </div>
                    <div id="physioResults" class="service-results" style="display: none;"></div>
                </div>
            </div>

            <!-- Blood Bank Service Content -->
            <div class="service-content" id="bloodBankContent">
                <div class="card">
                    <h2>ü©∏ Blood Bank Services</h2>
                    <div class="blood-bank-form">
                        <div class="form-group">
                            <label>Select Blood Type:</label>
                            <div class="blood-type-grid">
                                <button class="blood-type-btn" onclick="selectBloodType('A+')">A+</button>
                                <button class="blood-type-btn" onclick="selectBloodType('A-')">A-</button>
                                <button class="blood-type-btn" onclick="selectBloodType('B+')">B+</button>
                                <button class="blood-type-btn" onclick="selectBloodType('B-')">B-</button>
                                <button class="blood-type-btn" onclick="selectBloodType('AB+')">AB+</button>
                                <button class="blood-type-btn" onclick="selectBloodType('AB-')">AB-</button>
                                <button class="blood-type-btn" onclick="selectBloodType('O+')">O+</button>
                                <button class="blood-type-btn" onclick="selectBloodType('O-')">O-</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Urgency Level:</label>
                            <div class="urgency-levels">
                                <button class="urgency-btn" onclick="selectUrgency('low')">Low</button>
                                <button class="urgency-btn" onclick="selectUrgency('medium')">Medium</button>
                                <button class="urgency-btn" onclick="selectUrgency('high')">High</button>
                                <button class="urgency-btn critical" onclick="selectUrgency('critical')">Critical</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="bloodCity">City:</label>
                            <input type="text" id="bloodCity" placeholder="Enter your city" value="Delhi">
                        </div>

                        <div class="form-group">
                            <label for="bloodContact">Contact Number:</label>
                            <input type="tel" id="bloodContact" placeholder="Your contact number">
                        </div>

                        <div class="form-group">
                            <label for="bloodInfo">Additional Information:</label>
                            <textarea id="bloodInfo" rows="2" placeholder="Any additional information about the blood requirement..."></textarea>
                        </div>

                        <button type="button" class="btn" onclick="requestBlood()">Find Blood & Donors</button>
                    </div>
                    <div id="bloodBankResults" class="service-results" style="display: none;"></div>
                </div>
            </div>

            <!-- Hospital Finder Service Content -->
            <div class="service-content" id="hospitalContent">
                <div class="card">
                    <h2>üè• Smart Hospital Finder</h2>
                    <p style="color: #666; margin-bottom: 20px;">
                        Describe your medical issue and get AI-powered hospital recommendations with the best specialists for your condition.
                    </p>
                    <div class="hospital-form">
                        <div class="form-group">
                            <label for="medicalIssue">Describe your medical issue:</label>
                            <textarea id="medicalIssue" rows="3" placeholder="e.g., I have chest pain and shortness of breath, or I need a heart surgery consultation..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="hospitalCity">City:</label>
                            <select id="hospitalCity">
                                <option value="Delhi">Delhi</option>
                                <option value="Mumbai">Mumbai</option>
                                <option value="Bangalore">Bangalore</option>
                                <option value="Chennai">Chennai</option>
                                <option value="Kolkata">Kolkata</option>
                                <option value="Hyderabad">Hyderabad</option>
                                <option value="Pune">Pune</option>
                                <option value="Ahmedabad">Ahmedabad</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Urgency Level:</label>
                            <div class="urgency-levels">
                                <button class="urgency-btn" onclick="selectHospitalUrgency('low')">Low</button>
                                <button class="urgency-btn" onclick="selectHospitalUrgency('medium')">Medium</button>
                                <button class="urgency-btn" onclick="selectHospitalUrgency('high')">High</button>
                                <button class="urgency-btn critical" onclick="selectHospitalUrgency('critical')">Critical</button>
                            </div>
                        </div>

                        <button type="button" class="btn" onclick="findHospitals()">Find Best Hospitals</button>
                    </div>
                    <div id="hospitalResults" class="service-results" style="display: none;"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Health AI Platform - India | Educational Use Only | For medical emergencies, call 108</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Emergency: 108 | Police: 100 | Fire: 101 | Ambulance: 102 | Women Helpline: 1091
            </p>
        </div>
    </div>
    <button class="sos-btn" onclick="toggleSOS()">üö® Emergency</button>
    <!-- üöë Emergency Popup -->
          <div id="sosPopup" class="sos-popup">
              <h3>üöë Emergency Help</h3>
                  <ul>
                       <li>üöì Police: <a href="tel:100">100</a></li>
                      <li>üöë Ambulance: <a href="tel:108">108</a></li>
                      <li>üî• Fire: <a href="tel:101">101</a></li>
                      <li>üìû Universal Emergency: <a href="tel:112">112</a></li>
                      <li>üìû Women Helpline: <a href="tel:1091">1091</a></li>
                      <li>üìû Child Helpline: <a href="tel:1098">1098</a></li>
                      <li>üìû Mental Health: <a href="tel:1800-599-0019">1800-599-0019</a></li>
                      <li>üìû Poison Control: <a href="tel:1800-116-117">1800-116-117</a></li>
                      <li>üè• Nearest Hospital: <a href="https://www.google.com/maps/search/nearest+hospital/" target="_blank">Open in Google Maps</a></li>
                  </ul>
          </div>
          <script>
            function toggleSOS() {
              const popup = document.getElementById('sosPopup');
              popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
            }
          </script>
        
    <script>
        let symptoms = [];
        let chatSessionId = 'session_' + Date.now();
        let userData = {};
        let currentService = 'general';
        let selectedBloodType = '';
        let selectedUrgency = 'medium';
        
        // Initialize blood bank with default selections
        function initializeBloodBank() {
            // Set default urgency to medium
            selectedUrgency = 'medium';
            document.querySelectorAll('.urgency-btn').forEach(btn => {
                if (btn.textContent.toLowerCase() === 'medium') {
                    btn.classList.add('selected');
                }
            });
        }

        // Authentication and consent handling
        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get user data
            userData = {
                user_id: 'user_' + Date.now(),
                name: document.getElementById('userName').value,
                age: parseInt(document.getElementById('userAge').value),
                gender: document.getElementById('userGender').value,
                location: document.getElementById('userLocation').value,
                consent: document.getElementById('consentCheck').checked,
                timestamp: new Date().toISOString()
            };
            
            // Validate consent
            if (!userData.consent) {
                alert('Please agree to the terms and conditions to proceed.');
                return;
            }
            
            try {
                // Register user with backend
                const response = await fetch('/api/user/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                if (response.ok) {
                    // Hide auth modal and show main content
                    document.getElementById('authModal').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    
                    // Store user data in sessionStorage
                    sessionStorage.setItem('userData', JSON.stringify(userData));
                    
                    // Show welcome message
                    showWelcomeMessage();
                } else {
                    alert('Error registering user. Please try again.');
                }
            } catch (error) {
                console.error('Registration error:', error);
                alert('Error connecting to server. Please try again.');
            }
        });

        function showWelcomeMessage() {
            const chatContainer = document.getElementById('chatContainer');
            const welcomeMessage = document.createElement('div');
            welcomeMessage.className = 'chat-message assistant';
            welcomeMessage.innerHTML = `
                <strong>Welcome, ${userData.name}!</strong><br>
                I'm your health assistant. I can help you with symptom analysis and provide health information. 
                Remember, this is for educational purposes only. For medical emergencies, call 108.
            `;
            chatContainer.appendChild(welcomeMessage);
        }

        function openFirstAid() {
            window.open('firstaid.html', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
        }

        // Check if user is already authenticated
        window.addEventListener('load', function() {
            const storedUserData = sessionStorage.getItem('userData');
            if (storedUserData) {
                userData = JSON.parse(storedUserData);
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                showWelcomeMessage();
            }
        });

        // Add symptom to list
        function addSymptom() {
            const input = document.getElementById('symptomInput');
            const symptom = input.value.trim();
            
            if (symptom && !symptoms.includes(symptom)) {
                symptoms.push(symptom);
                updateSymptomsList();
                input.value = '';
            }
        }

        // Update symptoms list display
        function updateSymptomsList() {
            const container = document.getElementById('symptomsList');
            container.innerHTML = '';
            
            symptoms.forEach((symptom, index) => {
                const tag = document.createElement('div');
                tag.className = 'symptom-tag';
                tag.innerHTML = `${symptom} <span class="remove" onclick="removeSymptom(${index})">√ó</span>`;
                container.appendChild(tag);
            });
        }

        // Remove symptom from list
        function removeSymptom(index) {
            symptoms.splice(index, 1);
            updateSymptomsList();
        }

        // Handle symptom form submission
        document.getElementById('symptomForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (symptoms.length === 0) {
                alert('Please add at least one symptom');
                return;
            }

            const analyzeBtn = document.getElementById('analyzeBtn');
            const resultsDiv = document.getElementById('symptomResults');
            
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Analyzing...';
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading">Analyzing your symptoms...</div>';

            try {
                const response = await fetch('/api/symptoms/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: 'user_' + Date.now(),
                        symptoms: symptoms,
                        duration: document.getElementById('duration').value,
                        severity: document.getElementById('severity').value,
                        age: document.getElementById('age').value ? parseInt(document.getElementById('age').value) : null,
                        gender: document.getElementById('gender').value,
                        medical_history: [],
                        additional_info: document.getElementById('additionalInfo').value
                    })
                });

                const data = await response.json();
                displaySymptomResults(data);
                
            } catch (error) {
                resultsDiv.innerHTML = '<div style="color: red;">Error analyzing symptoms. Please try again.</div>';
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analyze Symptoms';
            }
        });

        // Display symptom analysis results
        function displaySymptomResults(data) {
            const resultsDiv = document.getElementById('symptomResults');
            
            let html = '<h3>Analysis Results</h3>';
            
            // Display possible conditions
            if (data.possible_conditions && data.possible_conditions.length > 0) {
                html += '<h4>Possible Conditions:</h4>';
                data.possible_conditions.forEach(condition => {
                    html += `
                        <div class="condition-card">
                            <div class="condition-name">${condition.name}</div>
                            <div class="probability">Probability: ${Math.round(condition.probability * 100)}%</div>
                            <span class="severity ${condition.severity}">${condition.severity}</span>
                            <p>${condition.description}</p>
                            ${condition.indian_context ? `<p style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin-top: 10px;"><strong>üáÆüá≥ Indian Context:</strong> ${condition.indian_context}</p>` : ''}
                        </div>
                    `;
                });
            }

            // Display first aid advice
            if (data.first_aid_advice) {
                html += `
                    <div class="first-aid">
                        <h4>First Aid Advice</h4>
                        <h5>Immediate Actions:</h5>
                        <ul>
                            ${data.first_aid_advice.immediate_actions.map(action => `<li>${action}</li>`).join('')}
                        </ul>
                        <h5>Things to Avoid:</h5>
                        <ul>
                            ${data.first_aid_advice.do_not_do.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        <h5>When to Seek Help:</h5>
                        <ul>
                            ${data.first_aid_advice.when_to_seek_help.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        ${data.first_aid_advice.indian_context ? `
                            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #ffc107;">
                                <h5 style="color: #856404; margin-bottom: 10px;">üáÆüá≥ Indian Healthcare Context:</h5>
                                <p style="color: #856404; margin: 0;">${data.first_aid_advice.indian_context}</p>
                            </div>
                        ` : ''}
                    </div>
                `;

                // Display emergency signs
                if (data.first_aid_advice.emergency_signs) {
                    html += `
                        <div class="emergency">
                            <h4>üö® Emergency Warning Signs</h4>
                            <p>Call 108 immediately if you experience:</p>
                            <ul>
                                ${data.first_aid_advice.emergency_signs.map(sign => `<li>${sign}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            // Display follow-up questions
            if (data.follow_up_questions) {
                html += `
                    <div class="suggested-questions">
                        <h4>Follow-up Questions</h4>
                        ${data.follow_up_questions.map(question => `<button class="question-btn" onclick="askQuestion('${question}')">${question}</button>`).join('')}
                    </div>
                `;
            }

            // Display disclaimer
            html += `<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; color: #856404;"><strong>Disclaimer:</strong> ${data.disclaimer} For medical emergencies in India, call 108.</div>`;

            resultsDiv.innerHTML = html;
        }

        // Ask a follow-up question
        function askQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendChatMessage();
        }

// ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
        // Send chat message
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            const chatContainer = document.getElementById('chatContainer');
            
            // Add user message to chat
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.textContent = message;
            chatContainer.appendChild(userMessage);
            
            // Add loading message
            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'chat-message assistant loading';
            loadingMessage.textContent = 'Thinking...';
            chatContainer.appendChild(loadingMessage);
            
            input.value = '';
            chatContainer.scrollTop = chatContainer.scrollHeight;

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: 'user_' + Date.now(),
                        message: message,
                        session_id: chatSessionId
                    })
                });

                const data = await response.json();
                
                // Remove loading message
                loadingMessage.remove();
                
                // Add assistant response
                const assistantMessage = document.createElement('div');
                assistantMessage.className = 'chat-message assistant';
                assistantMessage.textContent = data.response;
                chatContainer.appendChild(assistantMessage);
                // ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
                // Display suggested questions
                if (data.suggested_questions && data.suggested_questions.length > 0) {
                    const questionsDiv = document.getElementById('suggestedQuestions');
                    const questionsList = document.getElementById('questionsList');
                    
                    questionsList.innerHTML = '';
                    data.suggested_questions.forEach(question => {
                        const btn = document.createElement('button');
                        btn.className = 'question-btn';
                        btn.textContent = question;
                        btn.onclick = () => {
                            document.getElementById('chatInput').value = question;
                            sendChatMessage();
                        };
                        questionsList.appendChild(btn);
                    });
                    
                    questionsDiv.style.display = 'block';
                }
                
            } catch (error) {
                loadingMessage.remove();
                const errorMessage = document.createElement('div');
                errorMessage.className = 'chat-message assistant';
                errorMessage.textContent = 'Sorry, I encountered an error. Please try again.';
                chatContainer.appendChild(errorMessage);
            }
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Handle Enter key in chat input
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Handle Enter key in symptom input
        document.getElementById('symptomInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addSymptom();
            }
        });

        // Service selection functions
        function selectService(service) {
            console.log('Service selected:', service);
            currentService = service;
            
            // Update button states
            document.querySelectorAll('.service-btn').forEach(btn => btn.classList.remove('active'));
            
            // Handle different button ID formats
            let buttonId;
            if (service === 'blood_bank') {
                buttonId = 'bloodBankBtn';
            } else if (service === 'hospital') {
                buttonId = 'hospitalBtn';
            } else {
                buttonId = service + 'Btn';
            }
            
            console.log('Looking for button ID:', buttonId);
            const button = document.getElementById(buttonId);
            if (button) {
                button.classList.add('active');
                console.log('Button activated:', buttonId);
            } else {
                console.error('Button not found:', buttonId);
            }
            
            // Show/hide content
            document.querySelectorAll('.service-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.card').forEach(card => card.style.display = 'block');
            
            if (service === 'general') {
                document.getElementById('symptomCard').style.display = 'block';
                document.getElementById('nutritionContent').style.display = 'none';
                document.getElementById('physioContent').style.display = 'none';
                document.getElementById('bloodBankContent').style.display = 'none';
                document.getElementById('hospitalContent').style.display = 'none';
            } else {
                document.getElementById('symptomCard').style.display = 'none';
                
                // Handle different content ID formats
                let contentId;
                if (service === 'blood_bank') {
                    contentId = 'bloodBankContent';
                } else if (service === 'hospital') {
                    contentId = 'hospitalContent';
                } else {
                    contentId = service + 'Content';
                }
                
                const content = document.getElementById(contentId);
                if (content) {
                    content.style.display = 'block';
                }
                
                // Initialize services when selected
                if (service === 'blood_bank') {
                    initializeBloodBank();
                } else if (service === 'hospital') {
                    initializeHospitalFinder();
                }
            }
        }

        // Nutrition consultation
        async function getNutritionAdvice() {
            const query = document.getElementById('nutritionQuery').value.trim();
            if (!query) {
                alert('Please enter your nutrition question');
                return;
            }

            const resultsDiv = document.getElementById('nutritionResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading">Getting nutrition advice...</div>';

            try {
                const response = await fetch('/api/nutrition/consult', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userData.user_id || 'anonymous',
                        query: query,
                        user_context: {
                            age: userData.age,
                            gender: userData.gender,
                            location: userData.location
                        }
                    })
                });

                const data = await response.json();
                displayNutritionResults(data);
                
            } catch (error) {
                resultsDiv.innerHTML = '<div style="color: red;">Error getting nutrition advice. Please try again.</div>';
            }
        }

        function displayNutritionResults(data) {
            const resultsDiv = document.getElementById('nutritionResults');
            const prediction = data.prediction;
            
            let html = `
                <h3>Nutrition Advice</h3>
                <div class="condition-card">
                    <div class="condition-name">${prediction.category.replace('_', ' ').toUpperCase()}</div>
                    <div class="probability">Confidence: ${Math.round(prediction.confidence * 100)}%</div>
                    <p>${prediction.description}</p>
                </div>
            `;

            if (prediction.recommendations && prediction.recommendations.length > 0) {
                html += `
                    <div class="first-aid">
                        <h4>Recommendations:</h4>
                        <ul>
                            ${prediction.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (prediction.foods_to_include && prediction.foods_to_include.length > 0) {
                html += `
                    <div class="suggested-questions">
                        <h4>Foods to Include:</h4>
                        <ul>
                            ${prediction.foods_to_include.map(food => `<li>${food}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (prediction.meal_plan && Object.keys(prediction.meal_plan).length > 0) {
                html += `
                    <div class="first-aid">
                        <h4>Sample Meal Plan:</h4>
                        <ul>
                            <li><strong>Breakfast:</strong> ${prediction.meal_plan.breakfast || 'Not specified'}</li>
                            <li><strong>Lunch:</strong> ${prediction.meal_plan.lunch || 'Not specified'}</li>
                            <li><strong>Dinner:</strong> ${prediction.meal_plan.dinner || 'Not specified'}</li>
                            <li><strong>Snacks:</strong> ${prediction.meal_plan.snacks || 'Not specified'}</li>
                        </ul>
                    </div>
                `;
            }

            html += `<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; color: #856404;"><strong>Disclaimer:</strong> ${data.disclaimer}</div>`;

            resultsDiv.innerHTML = html;
        }

        // Physiotherapy consultation
        async function getPhysioAdvice() {
            const query = document.getElementById('physioQuery').value.trim();
            if (!query) {
                alert('Please enter your physiotherapy question');
                return;
            }

            const resultsDiv = document.getElementById('physioResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading">Getting physiotherapy advice...</div>';

            try {
                const response = await fetch('/api/physio/consult', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userData.user_id || 'anonymous',
                        query: query,
                        user_context: {
                            age: userData.age,
                            gender: userData.gender,
                            location: userData.location
                        }
                    })
                });

                const data = await response.json();
                displayPhysioResults(data);
                
            } catch (error) {
                resultsDiv.innerHTML = '<div style="color: red;">Error getting physiotherapy advice. Please try again.</div>';
            }
        }

        function displayPhysioResults(data) {
            const resultsDiv = document.getElementById('physioResults');
            const prediction = data.prediction;
            
            let html = `
                <h3>Physiotherapy Advice</h3>
                <div class="condition-card">
                    <div class="condition-name">${prediction.category.replace('_', ' ').toUpperCase()}</div>
                    <div class="probability">Confidence: ${Math.round(prediction.confidence * 100)}%</div>
                    <p>${prediction.description}</p>
                </div>
            `;

            if (prediction.exercises && prediction.exercises.length > 0) {
                html += `
                    <div class="first-aid">
                        <h4>Recommended Exercises:</h4>
                        <ul>
                            ${prediction.exercises.map(exercise => `<li>${exercise}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (prediction.recommendations && prediction.recommendations.length > 0) {
                html += `
                    <div class="suggested-questions">
                        <h4>General Recommendations:</h4>
                        <ul>
                            ${prediction.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (prediction.precautions && prediction.precautions.length > 0) {
                html += `
                    <div class="emergency">
                        <h4>Precautions:</h4>
                        <ul>
                            ${prediction.precautions.map(precaution => `<li>${precaution}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            html += `<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px; color: #856404;"><strong>Disclaimer:</strong> ${data.disclaimer}</div>`;

            resultsDiv.innerHTML = html;
        }

        // Blood bank functions
        function selectBloodType(bloodType) {
            console.log('Blood type selected:', bloodType);
            selectedBloodType = bloodType;
            document.querySelectorAll('.blood-type-btn').forEach(btn => btn.classList.remove('selected'));
            // Find the clicked button and add selected class
            document.querySelectorAll('.blood-type-btn').forEach(btn => {
                if (btn.textContent === bloodType) {
                    btn.classList.add('selected');
                    console.log('Blood type button highlighted:', bloodType);
                }
            });
        }

        function selectUrgency(urgency) {
            console.log('Urgency selected:', urgency);
            selectedUrgency = urgency;
            document.querySelectorAll('.urgency-btn').forEach(btn => btn.classList.remove('selected'));
            // Find the clicked button and add selected class
            document.querySelectorAll('.urgency-btn').forEach(btn => {
                if (btn.textContent.toLowerCase() === urgency.toLowerCase()) {
                    btn.classList.add('selected');
                    console.log('Urgency button highlighted:', urgency);
                }
            });
        }

        async function requestBlood() {
            console.log('Blood bank request started');
            console.log('Selected blood type:', selectedBloodType);
            console.log('Selected urgency:', selectedUrgency);
            
            if (!selectedBloodType) {
                alert('Please select a blood type');
                return;
            }

            const city = document.getElementById('bloodCity').value.trim();
            const contact = document.getElementById('bloodContact').value.trim();
            const info = document.getElementById('bloodInfo').value.trim();

            if (!city) {
                alert('Please enter your city');
                return;
            }

            console.log('Request data:', {
                blood_type: selectedBloodType,
                urgency_level: selectedUrgency,
                city: city,
                contact: contact,
                info: info
            });

            const resultsDiv = document.getElementById('bloodBankResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading">Searching for blood availability and donors...</div>';

            try {
                const response = await fetch('/api/blood-bank/request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userData.user_id || 'anonymous',
                        blood_type: selectedBloodType,
                        request_type: 'urgent_blood_request',
                        urgency_level: selectedUrgency,
                        city: city,
                        state: userData.location || 'Delhi',
                        contact_number: contact,
                        additional_info: info
                    })
                });

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Response data:', data);
                displayBloodBankResults(data);
                
            } catch (error) {
                console.error('Blood bank request error:', error);
                resultsDiv.innerHTML = `<div style="color: red;">Error searching for blood: ${error.message}. Please try again.</div>`;
            }
        }

        function displayBloodBankResults(data) {
            const resultsDiv = document.getElementById('bloodBankResults');
            
            let html = `
                <h3>Blood Bank Search Results</h3>
                <div class="condition-card">
                    <div class="condition-name">Blood Type: ${data.blood_type}</div>
                    <div class="probability">City: ${data.city}</div>
                </div>
            `;

            // Blood availability
            if (data.availability && data.availability.total_units_available > 0) {
                html += `
                    <div class="blood-availability">
                        <span>Total Blood Units Available: <span class="blood-units">${data.availability.total_units_available}</span></span>
                    </div>
                `;

                if (data.availability.hospitals_with_blood && data.availability.hospitals_with_blood.length > 0) {
                    html += `
                        <div class="first-aid">
                            <h4>Hospitals with Blood Available:</h4>
                    `;
                    data.availability.hospitals_with_blood.forEach(hospital => {
                        html += `
                            <div class="hospital-card">
                                <strong>${hospital.hospital_name}</strong><br>
                                <span>${hospital.city}, ${hospital.state}</span><br>
                                <span>Distance: ${hospital.distance_km} km</span><br>
                                <span>Units Available: ${hospital.blood_units_available}</span><br>
                                <span>Contact: ${hospital.contact}</span>
                            </div>
                        `;
                    });
                    html += `</div>`;
                }
            } else {
                html += `
                    <div class="emergency">
                        <h4>‚ö†Ô∏è No Blood Available in Nearby Hospitals</h4>
                        <p>Please contact emergency services or try expanding your search area.</p>
                    </div>
                `;
            }

            // Compatible donors
            if (data.compatible_donors && data.compatible_donors.length > 0) {
                html += `
                    <div class="suggested-questions">
                        <h4>Compatible Donors Found: ${data.total_donors_found}</h4>
                `;
                data.compatible_donors.slice(0, 5).forEach(donor => {
                    html += `
                        <div class="donor-card">
                            <strong>${donor.name}</strong><br>
                            <span>Blood Type: ${donor.blood_type}</span><br>
                            <span>Age: ${donor.age}, Gender: ${donor.gender}</span><br>
                            <span>City: ${donor.city}</span><br>
                            <span>Distance: ${donor.distance_km} km</span><br>
                            <span>Last Donation: ${donor.last_donation_days} days ago</span>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            // Emergency contacts
            if (data.emergency_contacts) {
                html += `
                    <div class="emergency">
                        <h4>Emergency Contacts:</h4>
                        <ul>
                            <li>National Blood Bank: ${data.emergency_contacts.national_blood_bank}</li>
                            <li>Red Cross India: ${data.emergency_contacts.red_cross_india}</li>
                            <li>Emergency Services: ${data.emergency_contacts.emergency_services}</li>
                        </ul>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
        }

        // Hospital Finder Functions
        let selectedHospitalUrgency = 'medium'; // Default

        function initializeHospitalFinder() {
            selectedHospitalUrgency = 'medium';
            document.querySelectorAll('.urgency-btn').forEach(btn => {
                if (btn.textContent.toLowerCase() === 'medium') {
                    btn.classList.add('selected');
                }
            });
        }

        function selectHospitalUrgency(urgency) {
            console.log('Hospital urgency selected:', urgency);
            selectedHospitalUrgency = urgency;
            document.querySelectorAll('.urgency-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.urgency-btn').forEach(btn => {
                if (btn.textContent.toLowerCase() === urgency.toLowerCase()) {
                    btn.classList.add('selected');
                    console.log('Hospital urgency button highlighted:', urgency);
                }
            });
        }

        async function findHospitals() {
            const medicalIssue = document.getElementById('medicalIssue').value.trim();
            const city = document.getElementById('hospitalCity').value;
            const urgency = selectedHospitalUrgency;

            if (!medicalIssue) {
                alert('Please describe your medical issue');
                return;
            }

            const resultsDiv = document.getElementById('hospitalResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px;">üîç Finding the best hospitals for your condition...</div>';

            try {
                const response = await fetch('/api/hospital/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        medical_issue: medicalIssue,
                        city: city,
                        urgency_level: urgency,
                        max_hospitals: 10
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayHospitalResults(data);
                } else {
                    resultsDiv.innerHTML = `<div style="color: red;">Error: ${data.error}</div>`;
                }
                
            } catch (error) {
                console.error('Hospital search error:', error);
                resultsDiv.innerHTML = `<div style="color: red;">Error finding hospitals: ${error.message}. Please try again.</div>`;
            }
        }

        function displayHospitalResults(data) {
            const resultsDiv = document.getElementById('hospitalResults');
            
            let html = `
                <h3>üè• Smart Hospital Recommendations</h3>
                    <div class="condition-card">
                        <div class="condition-name">Medical Issue: ${data.medical_issue}</div>
                        <div class="probability">Predicted Specialty: ${data.predicted_specialty}</div>
                        <div class="probability">üìç Location: ${data.recommendations[0]?.city || 'N/A'}, ${data.recommendations[0]?.state || 'N/A'}</div>
                        <div class="probability">üè• Hospitals Found: ${data.total_hospitals} in ${data.recommendations[0]?.state || 'N/A'} state</div>
                    </div>
            `;

            if (data.recommendations && data.recommendations.length > 0) {
                html += `
                    <div class="hospital-recommendations">
                        <h4>üèÜ Top ${data.total_hospitals} Hospital Recommendations:</h4>
                `;

                data.recommendations.forEach((hospital, index) => {
                    const rank = index + 1;
                    const specialtyMatch = hospital.specialty_match ? '‚úÖ' : '‚ùå';
                    const urgencyMatch = hospital.urgency_match ? '‚úÖ' : '‚ùå';
                    
                    html += `
                        <div class="hospital-card" style="border-left: 4px solid ${rank <= 3 ? '#28a745' : '#6c757d'};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h5 style="margin: 0; color: #2c3e50;">#${rank} ${hospital.name}</h5>
                                <span class="badge" style="background: ${hospital.overall_rating >= 4.5 ? '#28a745' : hospital.overall_rating >= 4.0 ? '#ffc107' : '#dc3545'}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                                    ‚≠ê ${hospital.overall_rating}/5.0
                                </span>
                            </div>
                            
                            <div style="margin-bottom: 10px;">
                                <strong>üìç Location:</strong> ${hospital.city}, ${hospital.state} (${hospital.distance_km} km away)<br>
                                <strong>üè• Specialties:</strong> ${specialtyMatch} ${hospital.specialty_match ? hospital.specialty_doctors + ' doctors' : 'Not specialized'}<br>
                                <strong>‚ö° Urgency Match:</strong> ${urgencyMatch} ${hospital.urgency_match ? 'Suitable' : 'Not ideal'}<br>
                                <strong>üìû Contact:</strong> ${hospital.contact_number}
                            </div>

                            ${hospital.specialty_match ? `
                                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                    <strong>üéØ ${data.predicted_specialty} Department:</strong><br>
                                    ‚Ä¢ Rating: ${hospital.specialty_rating}/5.0<br>
                                    ‚Ä¢ Success Rate: ${hospital.specialty_success_rate}%<br>
                                    ‚Ä¢ Wait Time: ${hospital.specialty_wait_time} days<br>
                                    ‚Ä¢ Doctors: ${hospital.specialty_doctors} specialists
                                </div>
                            ` : ''}

                            <div style="background: #e8f4fd; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                <strong>üí° Why Recommended:</strong><br>
                                ${hospital.recommendation_reason}
                            </div>

                            ${hospital.recommended_doctors && hospital.recommended_doctors.length > 0 ? `
                                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                                    <strong style="color: #856404; font-size: 14px;">üë®‚Äç‚öïÔ∏è Top Specialists:</strong><br>
                                    <div style="margin-top: 10px;">
                                        ${hospital.recommended_doctors.slice(0, 3).map(doctor => `
                                            <div style="background: white; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #28a745;">
                                                <strong>${doctor.name}</strong> (${doctor.qualification})<br>
                                                <span style="color: #6c757d; font-size: 12px;">
                                                    ‚≠ê ${doctor.rating}/5.0 | ${doctor.experience_years} years exp | ${doctor.success_rate}% success rate<br>
                                                    ${doctor.procedures_performed} procedures | ${doctor.patient_reviews} reviews
                                                </span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #007bff;">
                                <strong style="color: #2c3e50; font-size: 14px;">Hospital Details:</strong><br>
                                <div style="margin-top: 8px; font-size: 13px; color: #495057;">
                                    <strong>Capacity:</strong> Beds: ${hospital.bed_capacity} | ICU: ${hospital.icu_beds} | OT: ${hospital.operation_theaters}<br>
                                    <strong>Services:</strong> Emergency: ${hospital.emergency_services ? '‚úÖ' : '‚ùå'} | Ambulance: ${hospital.ambulance_services ? '‚úÖ' : '‚ùå'}<br>
                                    <strong>Financial:</strong> Insurance: ${hospital.insurance_accepted ? '‚úÖ' : '‚ùå'} | Cost: ${hospital.cost_level}
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;
            } else {
                html += `
                    <div class="emergency">
                        <h4>‚ö†Ô∏è No Hospitals Found</h4>
                        <p>No hospitals found for your condition. Please try a different city or contact emergency services.</p>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
